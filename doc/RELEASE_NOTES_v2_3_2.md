# リリースノート v2.3.2

## リリース日
2025-11-12

## 概要
**コンパイルエラー修正リリース**: 関数呼び出しを含む条件式の処理を改善し、単体テストファイルが正常にコンパイルできるように修正しました。

## 主な変更内容

### 🐛 バグ修正

#### 1. 関数呼び出しの誤った代入コード生成を修正

**問題:**
関数呼び出し（例: `Utf12()`）を含む条件式に対して、誤って代入コードを生成していました。

```c
// 修正前（コンパイルエラー）
Utf12() = 1;  // 左辺が関数呼び出し - エラー

// 修正後（TODOコメント）
// TODO: Utf12は関数またはenum定数のため初期化できません
```

**影響を受けていた条件式:**
- `if (Utf12() != 0)` - 引数なし関数呼び出しと数値の比較
- `if (v10 == Utf7())` - 変数と関数呼び出しの比較
- `if (UtD31(Utx171) != 0)` - 引数付き関数呼び出しと数値の比較

**修正内容:**
1. `BoundaryValueCalculator.parse_comparison()`に関数呼び出し検出機能を追加
   - `_is_function_call()`メソッドを実装
   - 関数呼び出しパターン（`func()`）を正規表現で検出
   - 左辺が関数呼び出しの場合は`None`を返す
   - 右辺が関数呼び出しの場合は適切なTODOコメントを生成

2. `BoundaryValueCalculator.generate_test_value()`を更新
   - 関数呼び出しを含む条件式の場合、適切な処理を実施
   - モック設定に関するTODOコメントを生成

3. `TestFunctionGenerator._generate_simple_condition_init()`を更新
   - `_is_function_call_pattern()`メソッドを追加
   - 関数呼び出しパターンを検出し、適切なTODOコメントを生成

4. `TestFunctionGenerator._generate_or_condition_init()`を更新
   - OR/AND条件でも関数呼び出しを適切に処理

## 影響範囲

### ✅ 改善されたケース

1. **引数なし関数呼び出し**
   ```c
   // 条件式: if (Utf7() == 0)
   // 生成コード:
   // TODO: Utf7は関数またはenum定数のため初期化できません
   ```

2. **変数と関数呼び出しの比較**
   ```c
   // 条件式: if (v10 == Utf7())
   // 生成コード:
   // TODO: mock_Utf7_return_value を設定して v10 と一致させる
   ```

3. **引数付き関数呼び出し**
   ```c
   // 条件式: if (UtD31(Utx171) != 0)
   // 生成コード:
   Utx171 = 1;  // TODO: 真になる値を設定
   ```

### 🎯 結果

- **コンパイルエラー**: 0件（関数呼び出し関連）
- **生成されるTODOコメント**: 明確で実用的
- **モック設定の指示**: 適切に生成

## テスト結果

### 単体テスト
```bash
$ python3 test_function_call_detection.py
✓ すべてのテストが完了しました

テスト項目:
- 関数呼び出しの検出: OK
- 変数と関数の区別: OK
- 初期化コード生成: OK
```

### 統合テスト
```bash
$ python3 test_real_world_generation.py
✓ テストコード生成が完了しました

検証項目:
- UtD31(Utx171) != 0: OK（引数変数を初期化）
- Utf7() == 0: OK（TODOコメント生成）
- UtD31(Utx171) < Utv7: OK（引数変数を初期化）
```

## 互換性

### 下位互換性
✅ **完全互換**: 既存のコード生成機能はすべて維持されています。

### アップグレード手順
1. 新しいバージョンのファイルを配置
2. 既存のテストコードを再生成（推奨）
3. コンパイルして動作確認

## 技術的詳細

### 修正されたファイル
1. `src/test_generator/boundary_value_calculator.py`
   - `_is_function_call()`メソッドの追加
   - `parse_comparison()`メソッドの拡張
   - `generate_test_value()`メソッドの更新

2. `src/test_generator/test_function_generator.py`
   - `_is_function_call_pattern()`メソッドの追加
   - `_generate_simple_condition_init()`メソッドの更新
   - `_generate_or_condition_init()`メソッドの更新

### 追加されたテストファイル
1. `test_function_call_detection.py` - 関数呼び出し検出機能の単体テスト
2. `test_real_world_generation.py` - 実際のコード生成シナリオのテスト

## 既知の問題

### 残存する制約事項
1. 複雑なマクロ関数（関数のような形式のマクロ）は、関数として扱われる可能性があります
2. 関数ポインタを使用した呼び出しは、現在のパターンマッチングでは検出されません

これらは将来のバージョンで対応予定です。

## 次のステップ

### v2.3.3以降で予定されている改善
- [ ] 構造体メンバーへの代入（例: `Utx112.Utm10`）のサポート
- [ ] ビットフィールドメンバーの初期化改善
- [ ] より詳細なTODOコメントの生成

## まとめ

v2.3.2は、単体テストファイルのコンパイル成功率を大幅に改善する重要なバグ修正リリースです。関数呼び出しを含む条件式が適切に処理され、コンパイルエラーが発生しなくなりました。

---

**リリース担当**: AutoUniTestGen開発チーム  
**前バージョン**: v2.3.1  
**次バージョン予定**: v2.3.3（構造体メンバー対応）
